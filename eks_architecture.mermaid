graph TB
    subgraph "GitHub"
        A[GitHub Repository]
        B[GitHub Actions CI/CD]
        C[Security Scanning - Trivy]
    end

    subgraph "Docker Hub"
        D[Docker Images]
    end

    subgraph "AWS Cloud - ap-south-1"
        subgraph "VPC"
            E[EKS Cluster - nasa-eks]
            subgraph "Managed Node Group"
                F[EC2 Instances<br/>t3.medium]
            end
        end

        G[S3 Bucket<br/>Terraform State]
        H[DynamoDB Table<br/>State Locking]
        I[KMS Key<br/>Cluster Encryption]
    end

    subgraph "Kubernetes Namespaces"
        subgraph "prod"
            J[Frontend App<br/>Deployment]
            K[Service]
            L[Ingress<br/>prod.nainika.store]
        end

        subgraph "stage"
            M[Frontend App<br/>Deployment]
            N[Service]
            O[Ingress<br/>stage.nainika.store]
        end

        subgraph "monitoring"
            P[Prometheus<br/>Operator]
            Q[Grafana<br/>Dashboards]
            R[AlertManager]
            S[ServiceMonitors]
        end

        subgraph "ingress-nginx"
            T[NGINX Ingress<br/>Controller]
            U[Network Load Balancer<br/>NLB]
        end

        subgraph "cert-manager"
            V[cert-manager<br/>Controller]
            W[Let's Encrypt<br/>ClusterIssuer]
            X[TLS Certificates]
        end
    end

    subgraph "External Services"
        Y[Route53 DNS<br/>nainika.store]
        Z[Let's Encrypt<br/>ACME Server]
    end

    %% CI/CD Flow
    A --> B
    B -->|Docker Build & Push| D
    B -->|Terraform Plan/Apply| E
    B -->|Security Scan| C
    C -->|SARIF Report| B

    %% Infrastructure Flow
    B -->|terraform apply| G
    B -->|terraform apply| H
    B -->|terraform apply| I
    G --> E
    H --> E
    I --> E

    %% Application Deployment Flow
    D -->|Pull Images| J
    D -->|Pull Images| M
    B -->|Helm Deploy| J
    B -->|Helm Deploy| K
    B -->|Helm Deploy| L
    B -->|Helm Deploy| M
    B -->|Helm Deploy| N
    B -->|Helm Deploy| O

    %% Monitoring Setup
    B -->|Helm Install| P
    B -->|Helm Install| Q
    B -->|Helm Install| R
    P -.->|Scrapes Metrics| J
    P -.->|Scrapes Metrics| M
    P -.->|Scrapes Metrics| T
    Q -.->|Dashboards| P

    %% Ingress & TLS Flow
    B -->|Helm Install| T
    T --> U
    U --> Y
    Y --> L
    Y --> O

    B -->|Helm Install| V
    V --> W
    W --> Z
    Z --> X
    X --> L
    X --> O

    %% Styling
    classDef githubClass fill:#238636,color:#ffffff
    classDef awsClass fill:#FF9900,color:#000000
    classDef k8sClass fill:#326CE5,color:#ffffff
    classDef externalClass fill:#6B46C1,color:#ffffff

    class A,B,C githubClass
    class E,F,G,H,I awsClass
    class J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X k8sClass
    class Y,Z externalClass